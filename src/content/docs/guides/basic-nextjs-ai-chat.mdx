---
title: Basic Next.js AI Chat
description: A guide in my new Starlight docs site.
---

import { Tabs, TabItem } from '@astrojs/starlight/components'
import { Steps } from '@astrojs/starlight/components';

<Steps>
1. ### Create a new Next.js project
    Next.js recommends <a href="https://nextjs.org/docs/getting-started/installation" target="_blank">starting a new Next.js</a> app using `create-next-app`, which sets up everything automatically for you. To create a project, run:

    ```shell
    npx create-next-app@latest
    ```

    Accept all the defaults.

2. ### Environment Variables
    Create `.env.local` file in the root of your project and add the following variables:


    ```text
    OPENAI_API_KEY=xxxxxx

    INVSY_API_KEY=xxxxxx
    INVSY_PROJECT_ID=xxxxxx
   ```

    Get your Invsy secret key and project ID from the <a href="https://dash.invsy.com" target="_blank">Invsy dashboard</a>

3. ### Install packages & create the Invsy instance
    Install the `invsy`, `ai` and `@ai-sdk/openai` SDKs by running:

    <Tabs>

        <TabItem label="npm" icon="seti:npm">
            ```sh
            npm add invsy ai @ai-sdk/openai
            ```
        </TabItem>

        <TabItem label="pnpm" icon="pnpm">
            ```sh
            pnpm add invsy ai @ai-sdk/openai
            ```
        </TabItem>

        <TabItem label="Yarn" icon="seti:yarn">
            ```sh
            yarn add invsy ai @ai-sdk/openai
            ```
        </TabItem>

    </Tabs>


    Then create the Invsy instance in a new file `./src/libs/invsy.ts`:
    ```ts
    import { Invsy } from "invsy"
    // add your own auth logic
    export const userId = 'user1'

    export const invsy = new Invsy(
      process.env.INVSY_API_KEY!,
      process.env.INVSY_PROJECT_ID!,
      userId
    )
    ```

4. ### Update the root page
    Replace the contents of `./src/page.tsx` with the following code:
    ```ts
    import { invsy } from "@/libs/invsy";
    import { redirect } from "next/navigation";

    export default async function Page() {
      // create new chat and returns the chat id
      const { id } = await invsy.create({
        title: 'new chat'
      })

      redirect(`/${id}`)
    }
    ```

5. ### Create the `ChatUI` component
    Create a new file `./src/components/chat-ui.tsx` and add the following code:
    ```tsx
    "use client"
    import { useChat } from "ai/react";

    type Props = {
      chat: any
    }

    export const ChatUi = ({ chat }: Props) => {
      const { messages, input, handleInputChange, handleSubmit } = useChat({
          api: `/api/chat/${chat.id}`,
          keepLastMessageOnError: true,
          initialMessages: chat.messages ? chat.messages : []
      });

      return (
        <>
          {messages.map((message, index) => (
            <div key={index}>
              {message.role === 'user' ? 'User: ' : 'AI: '}
                {message.content}
            </div>
          ))}

          <form onSubmit={handleSubmit}>
            <input name="prompt" value={input} onChange={handleInputChange} />
            <button type="submit">Submit</button>
          </form>
        </>
      );
    }
    ```

6. ### Create the chat page
    Create a new file `./src/app/[chat_id]/page.tsx` and add the following code:
    ```tsx
    import { ChatUi } from "@/components/chat-ui";
    import { invsy } from "@/libs/invsy";

    type Props = {
      params: {
        chat_id: string;
      };
    }

    export default async function ChatPage({params}: Props) {
      const chatId = params.chat_id
      const chat = await invsy.get(chatId);

      return (
        <>
          <ChatUi chat={chat}/>
        </>
      );
    }
    ```

7. ### Create the chat API
    Create a new file `./src/app/api/chat/[chat_id]/route.ts` and add the following code:
    ```tsx
    import { openai } from '@ai-sdk/openai';
    import { convertToCoreMessages, streamText } from 'ai';
    import { invsy } from "@/libs/invsy";

    // Allow streaming responses up to 30 seconds
    export const maxDuration = 30;

    export async function POST(req: Request, { params }: { params: { chat_id: string } }) {
        const { messages } = await req.json();

        const result = await streamText({
            model: openai('gpt-4-turbo'),
            system: 'You are a helpful assistant.',
            messages: convertToCoreMessages(messages),
            // You can determine message role by checking toolCalls, toolResults etc.
            async onFinish({ text, toolCalls, toolResults }) {
                messages.push({
                    role: 'assistant',
                    content: text
                })

                // implement storage logic:
                await invsy.save({
                    id: params.chat_id,
                    messages,
                    meta: {},
                });
            },
        });

        return result.toDataStreamResponse();
    }
    ```
</Steps>

Serve up your app by running `npm run dev` and navigate to `http://localhost:3000` in your browser.

**Congradulations!** You have successfully created a basic AI chat app using Next.js and Invsy. You can now customize the chat UI and add more features to your app.
